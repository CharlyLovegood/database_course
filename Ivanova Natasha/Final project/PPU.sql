WITH RECURSIVE cte AS
(
    SELECT MIN(CAST(dttm AS DATE)) AS dt FROM visits
        UNION ALL
    SELECT dt + INTERVAL 1 DAY
        FROM cte
    WHERE dt + INTERVAL 1 DAY <= (SELECT MAX(CAST(dttm AS DATE)) FROM visits)
),
PUD AS
(
    SELECT CAST(dttm AS DATE) AS dt, COUNT(DISTINCT  orders.client) as count
        FROM orders
        GROUP BY dt
),
DAU AS
(
    SELECT CAST(dttm AS DATE) AS dt, COUNT(DISTINCT visits.client) AS count
        FROM visits
        GROUP BY dt
)
SELECT cte.dt as day, COALESCE(PU.count, 0) / COALESCE(DAU.count, 1) AS PPU
    FROM cte
    LEFT JOIN PUD AS PU ON cte.dt = PU.dt
    LEFT JOIN DAU AS DAU ON cte.dt = DAU.dt;




PPU result:
+------------+--------+
| day        | PPU    |
+------------+--------+
| 2018-07-18 | 0.8571 |
| 2018-07-19 | 0.9618 |
| 2018-07-20 | 0.8730 |
| 2018-07-21 | 0.8611 |
| 2018-07-22 | 0.8370 |
| 2018-07-23 | 1.0083 |
| 2018-07-24 | 0.8871 |
| 2018-07-25 | 0.9699 |
| 2018-07-26 | 0.7752 |
| 2018-07-27 | 0.8623 |
| 2018-07-28 | 0.7483 |
| 2018-07-29 | 0.7852 |
| 2018-07-30 | 0.6794 |
| 2018-07-31 | 0.0000 |
| 2018-08-01 | 0.7246 |
| 2018-08-02 | 0.9370 |
| 2018-08-03 | 0.8561 |
| 2018-08-04 | 0.8000 |
| 2018-08-05 | 0.8201 |
| 2018-08-06 | 0.8904 |
| 2018-08-07 | 0.9649 |
| 2018-08-08 | 0.0000 |
| 2018-08-09 | 0.0000 |
| 2018-08-10 | 0.0000 |
| 2018-08-11 | 0.0000 |
| 2018-08-12 | 0.0000 |
| 2018-08-13 | 0.0000 |
| 2018-08-14 | 0.0000 |
| 2018-08-15 | 0.0000 |
| 2018-08-16 | 0.0000 |
| 2018-08-17 | 0.0000 |
| 2018-08-18 | 0.8947 |
| 2018-08-19 | 0.9021 |
| 2018-08-20 | 0.7778 |
| 2018-08-21 | 1.2105 |
| 2018-08-22 | 0.8214 |
| 2018-08-23 | 0.9141 |
| 2018-08-24 | 0.8779 |
| 2018-08-25 | 1.0221 |
| 2018-08-26 | 1.0244 |
| 2018-08-27 | 0.8652 |
| 2018-08-28 | 0.9071 |
| 2018-08-29 | 0.7537 |
| 2018-08-30 | 0.8333 |
| 2018-08-31 | 0.0000 |
| 2018-09-01 | 0.7584 |
| 2018-09-02 | 1.0149 |
| 2018-09-03 | 0.8403 |
| 2018-09-04 | 0.8862 |
| 2018-09-05 | 0.9470 |
| 2018-09-06 | 0.8636 |
| 2018-09-07 | 0.8601 |
| 2018-09-08 | 0.0000 |
| 2018-09-09 | 0.0000 |
| 2018-09-10 | 0.0000 |
| 2018-09-11 | 0.0000 |
| 2018-09-12 | 0.0000 |
| 2018-09-13 | 0.0000 |
| 2018-09-14 | 0.0000 |
| 2018-09-15 | 0.0000 |
| 2018-09-16 | 0.0000 |
| 2018-09-17 | 0.0000 |
| 2018-09-18 | 0.6644 |
| 2018-09-19 | 0.8014 |
| 2018-09-20 | 0.7483 |
| 2018-09-21 | 0.7606 |
| 2018-09-22 | 0.9859 |
| 2018-09-23 | 0.8077 |
| 2018-09-24 | 0.9000 |
| 2018-09-25 | 0.9173 |
| 2018-09-26 | 0.7883 |
| 2018-09-27 | 0.9781 |
| 2018-09-28 | 0.8417 |
| 2018-09-29 | 0.7692 |
| 2018-09-30 | 0.8258 |
| 2018-10-01 | 0.7612 |
| 2018-10-02 | 0.6503 |
| 2018-10-03 | 0.8049 |
| 2018-10-04 | 0.8881 |
| 2018-10-05 | 0.8800 |
| 2018-10-06 | 0.8370 |
| 2018-10-07 | 0.8929 |
| 2018-10-08 | 0.0000 |
| 2018-10-09 | 0.0000 |
| 2018-10-10 | 0.0000 |
| 2018-10-11 | 0.0000 |
| 2018-10-12 | 0.0000 |
| 2018-10-13 | 0.0000 |
| 2018-10-14 | 0.0000 |
| 2018-10-15 | 0.0000 |
| 2018-10-16 | 0.0000 |
| 2018-10-17 | 0.0000 |
| 2018-10-18 | 0.8380 |
| 2018-10-19 | 1.1802 |
| 2018-10-20 | 0.9773 |
| 2018-10-21 | 0.9690 |
| 2018-10-22 | 1.1207 |
| 2018-10-23 | 1.0619 |
| 2018-10-24 | 0.7778 |
| 2018-10-25 | 0.9754 |
| 2018-10-26 | 0.7299 |
| 2018-10-27 | 0.8000 |
| 2018-10-28 | 0.9104 |
| 2018-10-29 | 0.9779 |
| 2018-10-30 | 0.7669 |
| 2018-10-31 | 0.0000 |
| 2018-11-01 | 1.0455 |
| 2018-11-02 | 0.9370 |
| 2018-11-03 | 0.9754 |
| 2018-11-04 | 0.8955 |
| 2018-11-05 | 0.8571 |
| 2018-11-06 | 0.8015 |
| 2018-11-07 | 0.9635 |
| 2018-11-08 | 0.0000 |
| 2018-11-09 | 0.0000 |
| 2018-11-10 | 0.0000 |
| 2018-11-11 | 0.0000 |
| 2018-11-12 | 0.0000 |
| 2018-11-13 | 0.0000 |
| 2018-11-14 | 0.0000 |
| 2018-11-15 | 0.0000 |
| 2018-11-16 | 0.0000 |
| 2018-11-17 | 0.0000 |
| 2018-11-18 | 1.0077 |
| 2018-11-19 | 0.7609 |
| 2018-11-20 | 0.7208 |
| 2018-11-21 | 0.7687 |
| 2018-11-22 | 0.9545 |
| 2018-11-23 | 0.8714 |
| 2018-11-24 | 0.7153 |
| 2018-11-25 | 0.8258 |
| 2018-11-26 | 0.7388 |
| 2018-11-27 | 0.7826 |
| 2018-11-28 | 0.9531 |
| 2018-11-29 | 0.8750 |
| 2018-11-30 | 0.7895 |
| 2018-12-01 | 0.8151 |
| 2018-12-02 | 0.8686 |
| 2018-12-03 | 0.8777 |
| 2018-12-04 | 0.9754 |
| 2018-12-05 | 0.8626 |
| 2018-12-06 | 0.6522 |
| 2018-12-07 | 0.8333 |
| 2018-12-08 | 0.0000 |
| 2018-12-09 | 0.0000 |
| 2018-12-10 | 0.0000 |
| 2018-12-11 | 0.0000 |
| 2018-12-12 | 0.0000 |
| 2018-12-13 | 0.0000 |
| 2018-12-14 | 0.0000 |
| 2018-12-15 | 0.0000 |
| 2018-12-16 | 0.0000 |
| 2018-12-17 | 0.0000 |
| 2018-12-18 | 1.0708 |
| 2018-12-19 | 0.9701 |
| 2018-12-20 | 0.9435 |
| 2018-12-21 | 0.8591 |
| 2018-12-22 | 0.8561 |
| 2018-12-23 | 0.8099 |
| 2018-12-24 | 0.9758 |
| 2018-12-25 | 0.9573 |
| 2018-12-26 | 0.8047 |
| 2018-12-27 | 0.8222 |
| 2018-12-28 | 0.8125 |
| 2018-12-29 | 0.6577 |
| 2018-12-30 | 0.8595 |
| 2018-12-31 | 0.0000 |
| 2019-01-01 | 0.8593 |
| 2019-01-02 | 0.7143 |
| 2019-01-03 | 0.9214 |
| 2019-01-04 | 0.8462 |
| 2019-01-05 | 0.8195 |
| 2019-01-06 | 0.7068 |
| 2019-01-07 | 0.9769 |
| 2019-01-08 | 0.0000 |
| 2019-01-09 | 0.0000 |
| 2019-01-10 | 0.0000 |
| 2019-01-11 | 0.0000 |
| 2019-01-12 | 0.0000 |
| 2019-01-13 | 0.0000 |
| 2019-01-14 | 0.0000 |
| 2019-01-15 | 0.0000 |
| 2019-01-16 | 0.0000 |
| 2019-01-17 | 0.0000 |
| 2019-01-18 | 0.8392 |
| 2019-01-19 | 0.8069 |
| 2019-01-20 | 0.8077 |
| 2019-01-21 | 0.8797 |
| 2019-01-22 | 0.8203 |
| 2019-01-23 | 0.9764 |
| 2019-01-24 | 0.8740 |
| 2019-01-25 | 0.7241 |
| 2019-01-26 | 1.0661 |
| 2019-01-27 | 0.9690 |
| 2019-01-28 | 0.8640 |
| 2019-01-29 | 0.8750 |
| 2019-01-30 | 1.0000 |
| 2019-01-31 | 0.0000 |
| 2019-02-01 | 1.0465 |
| 2019-02-02 | 0.9928 |
| 2019-02-03 | 0.8931 |
| 2019-02-04 | 0.8095 |
| 2019-02-05 | 1.0455 |
| 2019-02-06 | 0.9624 |
| 2019-02-07 | 0.6125 |
| 2019-02-08 | 0.0000 |
| 2019-02-09 | 0.0000 |
| 2019-02-10 | 0.0000 |
| 2019-02-11 | 0.0000 |
| 2019-02-12 | 0.0000 |
| 2019-02-13 | 0.0000 |
| 2019-02-14 | 0.0000 |
| 2019-02-15 | 0.0000 |
| 2019-02-16 | 0.0000 |
| 2019-02-17 | 0.0000 |
| 2019-02-18 | 0.6471 |
| 2019-02-19 | 0.9512 |
| 2019-02-20 | 0.9124 |
| 2019-02-21 | 0.6824 |
| 2019-02-22 | 0.8235 |
| 2019-02-23 | 0.8085 |
| 2019-02-24 | 0.7376 |
| 2019-02-25 | 0.9462 |
| 2019-02-26 | 0.8968 |
| 2019-02-27 | 0.9130 |
| 2019-02-28 | 0.8592 |
| 2019-03-01 | 0.7785 |
| 2019-03-02 | 0.8345 |
| 2019-03-03 | 0.6906 |
| 2019-03-04 | 0.9350 |
| 2019-03-05 | 0.9141 |
| 2019-03-06 | 0.8222 |
| 2019-03-07 | 0.8321 |
| 2019-03-08 | 0.0000 |
| 2019-03-09 | 0.0000 |
| 2019-03-10 | 0.0000 |
| 2019-03-11 | 0.0000 |
| 2019-03-12 | 0.0000 |
| 2019-03-13 | 0.0000 |
| 2019-03-14 | 0.0000 |
| 2019-03-15 | 0.0000 |
| 2019-03-16 | 0.0000 |
| 2019-03-17 | 0.0000 |
| 2019-03-18 | 0.8872 |
| 2019-03-19 | 0.9231 |
| 2019-03-20 | 0.9339 |
| 2019-03-21 | 0.8492 |
| 2019-03-22 | 0.9417 |
| 2019-03-23 | 0.8369 |
| 2019-03-24 | 0.7303 |
| 2019-03-25 | 0.8702 |
| 2019-03-26 | 0.9160 |
| 2019-03-27 | 0.8582 |
| 2019-03-28 | 0.8239 |
| 2019-03-29 | 0.8421 |
| 2019-03-30 | 0.8968 |
| 2019-03-31 | 0.0000 |
| 2019-04-01 | 1.0932 |
| 2019-04-02 | 0.8500 |
| 2019-04-03 | 0.7698 |
| 2019-04-04 | 0.8380 |
| 2019-04-05 | 0.9593 |
| 2019-04-06 | 0.9021 |
| 2019-04-07 | 0.7985 |
| 2019-04-08 | 0.0000 |
| 2019-04-09 | 0.0000 |
| 2019-04-10 | 0.0000 |
| 2019-04-11 | 0.0000 |
| 2019-04-12 | 0.0000 |
| 2019-04-13 | 0.0000 |
| 2019-04-14 | 0.0000 |
| 2019-04-15 | 0.0000 |
| 2019-04-16 | 0.0000 |
| 2019-04-17 | 0.0000 |
| 2019-04-18 | 0.8710 |
| 2019-04-19 | 0.8955 |
| 2019-04-20 | 0.8487 |
| 2019-04-21 | 0.9699 |
| 2019-04-22 | 0.7181 |
| 2019-04-23 | 0.8370 |
| 2019-04-24 | 0.6940 |
| 2019-04-25 | 0.7737 |
| 2019-04-26 | 0.9478 |
| 2019-04-27 | 0.8279 |
| 2019-04-28 | 0.7143 |
| 2019-04-29 | 0.8276 |
| 2019-04-30 | 0.8561 |
| 2019-05-01 | 0.8489 |
| 2019-05-02 | 1.1982 |
| 2019-05-03 | 0.7941 |
| 2019-05-04 | 1.1560 |
| 2019-05-05 | 0.9203 |
| 2019-05-06 | 0.7153 |
| 2019-05-07 | 0.8276 |
+------------+--------+
